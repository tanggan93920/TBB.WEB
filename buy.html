<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>囤币吧个人中心</title>
	<meta name="description" content="">
	<!-- Place favicon.ico in the root directory -->
	<!-- all css here -->
	<!-- bootstrap v3.3.6 css -->
	<link rel="stylesheet" href="./static/css/bootstrap.min.css">
	<!-- animate css -->
	<link rel="stylesheet" href="./static/css/animate.css">
	<!-- jquery-ui.min css -->
	<link rel="stylesheet" href="./static/css/jquery-ui.min.css">
	<!-- meanmenu css -->
	<link rel="stylesheet" href="./static/css/meanmenu.min.css">
	<!-- bxslider css -->
	<!--flaticon css -->
	<link rel="stylesheet" href="./static/css/flaticon.css">
	<!-- style css -->
	<link rel="stylesheet" href="./static/css/style.css">
	<!-- responsive css -->
	<link rel="stylesheet" href="./static/css/responsive.css">
</head>

<body>
	<header class="gc_main_menu_wrapper">
		<div class="container-fluid">
			<div class="row">
				<div class="pull-left" style="margin-left: 10px">
					<div class="logo-area">
						<a href="javascript:;">
							<img width="60" src="./static/img/logo.png" alt="logo">
						</a>
					</div>
				</div>
				<!-- Mobile Menu  Start -->
				<div class="pull-right" style="margin-right: 10px">
					<div class="menu-area  hidden-xs">
						<nav class="wd_single_index_menu btc_main_menu">
							<div id="webNav" class="webNav">
								<div id="navV2Wrap">
									<div id="navV2" class="nav navV2">
										<div class="navMainContent">
											<div class="navContent">
												<div id="navCenterContent" class="navCenterContent">
													<div id="navCenter" class="navCenter" style="width: 680px;">
														<div class="itemContainer">
															<div title="" id="nav2" class="item itemCol2 itemIndex1 itemSelectedIndex1" colid="2">
																<div class="itemCenter">
																	<a hidefocus="true" href="index.html">
																		<span class="itemName0">首页</span>
																	</a>
																</div>
															</div>
															<div title="" id="nav103" class="item itemCol103 itemIndex2" colid="103">
																<div class="itemCenter">
																	<a hidefocus="true" download="囤币吧安装程序.exe" href="./downloads/囤币吧安装程序.exe">
																		<span class="itemName0">软件下载</span>
																	</a>
																</div>
															</div>
															<div title="" id="nav103" class="item itemCol103 itemIndex2" colid="103">
																<div class="itemCenter">
																	<a hidefocus="true" href="notice.html">
																		<span class="itemName0">公告</span>
																	</a>
																</div>
															</div>
															<div title="" id="nav103" class="item itemCol103 itemIndex2" colid="103">
																<div class="itemCenter openLevel">
																	<a hidefocus="true" style="outline:none;" href="javascript:;">
																		<span class="itemName0">社区直播</span>
																	</a>
																</div>
															</div>
															<div title="" id="nav103" class="item itemCol103 itemIndex2" colid="103">
																<div class="itemCenter openLevel">
																	<a hidefocus="true" style="outline:none;" href="javascript:;">
																		<span class="itemName0">交易大厅</span>
																	</a>
																</div>
															</div>
															<div title="" id="nav103" class="item itemCol103 itemIndex2" colid="103">
																<div class="itemCenter" id="contact">
																	<a hidefocus="true" style="outline:none;" href="javascript:;">
																		<span class="itemName0">联系我们</span>
																	</a>
																</div>
															</div>
															<div style="display: none;" id="personCenter" class="item itemSelected itemCol104 itemIndex5" colid="104">
																<div class="itemCenter">
																	<a hidefocus="true" style="outline:none;" href="javascript:;">
																		<span class="itemName0">个人中心</span>
																	</a>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</nav>
						<div id="user-status">
							<div class="dropup-menu" style="display: none;">
								<button class="btn btn-default 
										dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
								<ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
									<li id="logout">
										<a href="#">退出</a>
									</li>
								</ul>
							</div>
							<div class="login-btn" style="display: none;">
								<a href="login.html" class="btn1">
									<span>登录</span>
								</a>
								<a href="register.html" class="btn1">
									<span>注册</span>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>
	<section class="person-section">
		<div class="person-body">
			<div class="person-left-area">
				<!--<div class="person-header">
						<img src="http://content.qimooc.com/0000/0034/img/201705/23/10/0454/030342a3-1a39-4d2c-99fc-5721ed7cff8e.jpg" class="avater">
						<div class="name">昵称：<span class="UserName"></span></div>
						<div class="phone">手机号：<span class="Mobile"></span></div>
					</div>-->
				<div class="person-item person-item01">
					<a href="person.html">基本信息</a>
				</div>
				<div class="person-item person-item06">
					<a href="vip.html">我的会员</a>
				</div>
				<div class="person-item person-item07">
					<a href="winmoney.html">我的佣金</a>
				</div>
				<div class="person-item person-item02">
					<a href="password.html">修改密码</a>
				</div>
				<div class="person-item person-item03">
					<a href="order.html">会员服务订单记录</a>
				</div>
				<div class="person-item person-item-active person-item04">
					<a href="javascript:;">购买VIP服务</a>
				</div>
				<div class="person-item person-item05">
					<a href="spread.html">推广链接</a>
				</div>
			</div>
			<div class="person-right-area">
				<div class="buy-area">
					<h5 class="title">购买使用时间</h5>
					<div class="buy-type" id="buyType"></div>
					<input type="hidden" id="buyId" />
				</div>
				<div class="pay-area">
					<h5 class="title">支付方式</h5>
					<div class="pay-type" id="payType"></div>
					<input type="hidden" id="payId" />
				</div>
				<div class="validate-code">验证码：
					<input type="text" id="validate" />
					<img id="validateImg" src="" />
					<a href="javascript:;" onclick="changeValidate()">换一张</a>
					<input type="hidden" id="validateKey" />
				</div>
				<button class="tj-btn" id="tjBtn">提交</button>
				<div style="color: red">下订单以后记得填写【付款码】，付款后请点击确认付款，中间出现异常请联系客服</div>
			</div>
		</div>
	</section>

	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="margin: 80px auto;">
			<div class="modal-content" style="padding: 30px;">
				<div style="color: #333; font-size: 12px;">申请已经提交，请及时向以下收款账号（蓝色字体）转账。</div>
				<div class="account" style="color: blue; font-weight: bold; font-size: 16px;"></div>
				<div class="pay-money" style="color: red;"></div>
				<div style="font-size: 14px; color: rgb(136,35,85);">请在付款时一定要填写付款码（
					<span style="color: red;" class="statusCode"></span>），以便快速确认您的申请。</div>
				<div style="font-size: 12px; color: gray;">申请被确认之后才能到您的账上，请稍等。</div>
				<button type="button" onclick="confirmBtn()" class="btn btn-primary" style="float: right;">确认</button>
				<div class="clearfix"></div>
			</div>
		</div>
	</div>

	<script src="static/js/jquery-3.2.1.min.js"></script>
	<script src="./static/js/bootstrap.min.js"></script>
	<script src="static/js/index.js"></script>
	<script>
		var path = 'https://api.tunbiba.com';
		var buyData = [];
		$(function () {
			var userInfo = JSON.parse(localStorage.getItem('userInfo'));
			$.ajax({
				url: path + "/Api/Order/GetProducts",
				dataType: 'json',
				success: function (result) {
					if (result.Success) {
						buyData = result.ResponseObject;
						var _html = '';
						for (var i = 0; i < buyData.length; i++) {
							_html += '<label>';
							if (buyData[i].Enabled) {
								_html += '<input type="radio" onclick="checkBuyType(' + buyData[i].Id + ')" name="optionsRadios">';
							} else {
								_html += '<input type="radio" disabled name="optionsRadios">';
							}
							_html += '' + buyData[i].ProductName + '</label>';
						}
						$('#buyType').html(_html);
						$.ajax({
							url: path + "/Api/Order/GetPayTypeList",
							dataType: 'json',
							success: function (result) {
								if (result.Success) {
									var _html = '';
									var data = result.ResponseObject;
									for (var i = 0; i < data.length; i++) {
										_html += '<div><label><input type="radio" ';
										_html += 'onclick="checkPayType(' + data[i].Id + ')"';
										_html += 'name="payOptions">' + data[i].PayTypeName + '</label>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue">';
										if (data[i].BankName) {
											_html += '' + data[i].BankName + data[i].OpenBankName + '支行：';
										}
										_html += '' + data[i].CardNo + '</span>';
										if (data[i].PayTypeName == 'RMB') {
											_html += '<span class="translateMoney" id="RmbPrice">' + buyData[0].RmbPrice + '</span>';
										} else {
											_html += '<span class="translateMoney" id="EthPrice">' + buyData[0].EthPrice + '</span>';
										}
										_html += '</div>';
									}
									$('#payType').html(_html);
								} else {
									bw.toast(result.Message);
								}
							}
						});
					} else {
						bw.toast(result.Message);
					}
				}
			});

			//图形验证码
			getValidateCode();

			// 提交
			$('#tjBtn').click(function () {
				var buyId = $('#buyId').val();
				var payId = $('#payId').val();
				var validate = $('#validate').val();
				var validateKey = $('#validateKey').val();
				if (!buyId) {
					bw.toast('请先选择套餐');
					return false;
				}
				if (!payId) {
					bw.toast('请先选择支付方式');
					return false;
				}
				if (!validate) {
					bw.toast('请先输入验证码');
					return false;
				}
				$.post(path + '/Api/Order/CreateOrder', {
					ProductId: buyId,
					PayTypeId: payId,
					Token: userInfo.Token,
					From: 1,
					ImageVerifyKey: validateKey,
					ImageVerifyCode: validate
				}, function (result) {
					if (result.Success) {
						if (result.ResponseObject) {
							$('#myModal').modal('show');
							$('.statusCode').text(result.ResponseObject.TradeNo);
							if (result.ResponseObject.PayTypeName == 'RMB') {
								var txt = result.ResponseObject.CardName + '：' + result.ResponseObject.BankName + '' + result.ResponseObject.OpenBankName + '支行：' + '' + result.ResponseObject.CardNo
								$('.account').html(txt);
							} else {
								$('.account').html('<span>' + result.ResponseObject.CardNo + '</span>');
							}
							$('.pay-money').text(result.ResponseObject.Price)
						}else{
							bw.toast(result.Message);
						}
					} else {
						bw.toast(result.Message);
					}
				})
			});
		});

		function confirmBtn() {
			$('#myModal').modal('hide');
			var host = window.location.protocol + '//' + window.location.host + '/order.html';
			window.location.href = host;
		}

		function getValidateCode() {
			$.ajax({
				type: "get",
				url: path + "/Api/User/GetImageValidateCode",
				dataType: 'json',
				success: function (result) {
					if (result.Success) {
						$('#validateImg').attr('src', result.ResponseObject.ImageBase64);
						$('#validateKey').val(result.ResponseObject.Key);
					}
				}
			});
		}

		function changeValidate() {
			getValidateCode();
		}

		function checkBuyType(id) {
			$('#buyId').val(id);
			for (var i = 0; i < buyData.length; i++) {
				if (id == buyData[i].Id) {
					$('#RmbPrice').text(buyData[i].RmbPrice);
					$('#EthPrice').text(buyData[i].EthPrice);
				}
			}
		}

		function checkPayType(id) {
			$('#payId').val(id);
		}
	</script>

</body>

</html>